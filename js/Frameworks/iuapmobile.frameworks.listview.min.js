"function"==typeof require&&require.config({baseUrl:"js",paths:{jquery:"jquery-2.1.4.min",UM:"Frameworks/iuapmobile.frameworks.core"}}),function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t):function(t){if(!t.document)throw new Error("listview requires a window with a document");return e(t)}:"function"==typeof define&&define.amd?define(["jquery","UM"],function(){return e(t)}):e(t)}("undefined"!=typeof window?window:this,function(t){function e(t,e){this._events=new UM.EventMgr,this.$element=$(t),this.$parent=this.$element.parent(),this.$list=this.$element.children("ul"),this._$domUp=null,this._$domDown=null,this._$domLoad=null,this._$domResult=null,this._contentHeight=0,this._viewHeight=0,this._scrollTop=0,this._pullDirection="",this._isPulling=!1,this._startY=0,this._curY=0,this._moveY=0,this._offsetY=0,this._longTapEvent=null,this.pulldownTime=null,this.pullUpTime=null,this.init(e)}e.prototype.init=function(t){var e=this;if(!e.$list||0==e.$list.length)return console.log("列表控件缺少必要的ul元素"),!1;e.config={insertDOM:!1,isScroll:!0,hasOpeningItemMenu:!1,ensureTouchDirect:!1,tapHoldEnable:!1,itemClickEnable:!1,itemDeleteEnable:!1,pullDownEnable:!1,pullUpEnable:!1,itemSwipeEnable:!1},e._touchMethods={fnTouches:function(t){t.touches||(t.touches=t.originalEvent.touches)},fnTouchstart:function(t,e){e._startY=t.touches[0].pageY,e._viewHeight=e.$element.height(),e._contentHeight=e.$element.get(0).scrollHeight,e._scrollTop=e.$element.scrollTop()},fnTouchmove:function(t,e){e._curY=t.touches[0].pageY,e._moveY=e._curY-e._startY,e._moveY>0?e._pullDirection="down":e._moveY<0&&(e._pullDirection="up");var i=Math.abs(e._moveY);e.config.pullDownEnable&&e._scrollTop<=0&&"down"==e._pullDirection&&(t.preventDefault(),clearTimeout(this.pulldownTime),e.config.insertDOM||(e.$element.prepend('<div class="'+e.opts.domUp.domClass+'"></div>'),e.config.insertDOM=!0),e._$domUp=$("."+e.opts.domUp.domClass),e._touchMethods.fnTransition(e._$domUp,0),i<=e.opts.pullDistance?(e._offsetY=i,e._$domUp.html(e.opts.domUp.domRefresh)):i>e.opts.pullDistance&&i<=2*e.opts.pullDistance?(e._offsetY=e.opts.pullDistance+.5*(i-e.opts.pullDistance),e._$domUp.html(e.opts.domUp.domUpdate)):e._offsetY=e.opts.pullDistance+.5*e.opts.pullDistance+.2*(i-2*e.opts.pullDistance),e._$domUp.css({height:e._offsetY})),e.config.pullUpEnable&&e._contentHeight<=e._viewHeight+e._scrollTop&&"up"==e._pullDirection&&(t.preventDefault(),clearTimeout(this.pullUpTime),e.config.insertDOM||(e.$element.append('<div class="'+e.opts.domDown.domClass+'"></div>'),e.config.insertDOM=!0),e._$domDown=$("."+e.opts.domDown.domClass),e._touchMethods.fnTransition(e._$domDown,0),i<=e.opts.pullDistance?(e._offsetY=i,e._$domDown.html(e.opts.domDown.domRefresh)):i>e.opts.pullDistance&&i<=2*e.opts.pullDistance?(e._offsetY=e.opts.pullDistance+.5*(i-e.opts.pullDistance),e._$domDown.html(e.opts.domDown.domUpdate)):e._offsetY=e.opts.pullDistance+.5*e.opts.pullDistance+.2*(i-2*e.opts.pullDistance),e._$domDown.css({height:e._offsetY}),e.$element.scrollTop(e._offsetY+e._scrollTop))},fnTouchend:function(t){var e=Math.abs(t._moveY);t.config.insertDOM&&("down"==t._pullDirection?(t._$domResult=t._$domUp,t.domLoad=t.opts.domUp.domLoad):"up"==t._pullDirection&&(t._$domResult=t._$domDown,t.domLoad=t.opts.domDown.domLoad),t._touchMethods.fnTransition(t._$domResult,300),e>t.opts.pullDistance?(t._$domResult.css({height:t._$domResult.children().height()}),t._$domResult.html(t.domLoad),t._touchMethods.fnCallback(t)):t._$domResult.css({height:"0"}).on("webkitTransitionEnd",function(){t.config.insertDOM=!1,$(this).remove()}),t._moveY=0)},fnTouchDirection:function(t,e,i){var o=i.pageX-e.pageX,n=i.pageY-e.pageY,s=Math.atan2(o,n),l=Math.abs(Math.cos(s));if(t.config.ensureTouchDirect=!0,l>=.78){if(n>0)return"down";if(n<0)return"up"}else if(l<.78){if(o>0)return"right";if(o<0)return"left"}return""},fnCallback:function(t){t.config.pullDownEnable&&"down"==t._pullDirection?(t._$domResult&&t._$domResult.css({height:40}),this.isPulling=!0,this.pulldownTime=setTimeout(function(){t._events.trigger("pullDown",t,{})},1e3)):t.config.pullUpEnable&&"up"==t._pullDirection&&(t._$domResult&&t._$domResult.css({height:40}),this.isPulling=!0,this.pullUpTime=setTimeout(function(){t._events.trigger("pullUp",t,{})},1e3))},fnTransition:function(t,e){t.css({"-webkit-transition":"all "+e+"ms",transition:"all "+e+"ms"})}},e.opts=$.extend({},{height:0,width:0,domUp:{domClass:"um-listview-up",domRefresh:'<div class="um-listview-refresh">↓下拉刷新</div>',domUpdate:'<div class="um-listview-update">↑释放更新</div>',domLoad:'<div class="um-listview-load"><div class="um-listview-loader"><span></span><span></span><span></span><span></span></div><div class="pullDownLabel">Loading...</div></div>'},domDown:{domClass:"um-listview-down",domRefresh:'<div class="um-listview-refresh">↑上拉加载更多</div>',domUpdate:'<div class="um-listview-update">↓释放加载</div>',domLoad:'<div class="um-listview-load"><div class="um-listview-loader"><span></span><span></span><span></span><span></span></div><div class="pullDownLabel">Loading...</div></div>'},hasItemMenu:!0,showLoadingBar:!0,pullDistance:40,tapHoldTime:500,itemDeleteAnimateTime:500},t),e.$list.on("touchstart",function(t){var i;if(e.opts.hasItemMenu&&(i=e.$list.find(".um-swipe-open"),i.length&&0==i.find(t.target).length))return e.config.hasOpeningItemMenu=!0,i.removeClass("um-swipe-open").parent(".um-list-item").css("transform","translate3d(0,0,0)"),!1;e.config.tapHoldEnable&&(e._longTapEvent=setTimeout(function(){e._events.trigger("longTap",e,{})},e.opts.tapHoldTime)),e.isPulling||(e._touchMethods.fnTouches(t),e._touchMethods.fnTouchstart(t,e))}),e.$list.on("touchmove",function(t){if(e._longTapEvent&&clearTimeout(e._longTapEvent),e.config.hasOpeningItemMenu)return t.preventDefault(),t.stopPropagation(),!1;e.isPulling||(e._touchMethods.fnTouches(t,e),e._touchMethods.fnTouchmove(t,e))}),e.$list.on("touchend",function(t){e._longTapEvent&&clearTimeout(e._longTapEvent),e.config.hasOpeningItemMenu=!1,e.isPulling||e._touchMethods.fnTouchend(e)}),e.$list.on("touchstart",".um-listview-row",function(t){if(e.config.itemSwipeEnable){e.config.isScroll=!0,e.config.ensureTouchDirect=!1;var i=t.originalEvent.targetTouches[0],o={pageX:i.pageX,pageY:i.pageY};$(this).data("touchPosOri",o)}}),e.$list.on("touchmove",".um-listview-row",function(t){if(e.config.itemSwipeEnable){var i,o,n,s,l;if(e.config.isScroll||(t.preventDefault(),t.stopPropagation()),!e.config.ensureTouchDirect)switch(s=$(this),l=s.index(),i=t.originalEvent.targetTouches[0],n={pageX:i.pageX,pageY:i.pageY},o=$(this).data("touchPosOri"),e._touchMethods.fnTouchDirection(e,o,n)){case"left":t.preventDefault(),t.stopPropagation(),e.config.isScroll=!1,!e.config.hasOpeningItemMenu&&e._events.trigger("itemSwipeLeft",e,{rowIndex:l,$target:s});break;case"right":t.preventDefault(),t.stopPropagation(),e.config.isScroll=!1,!e.config.hasOpeningItemMenu&&e._events.trigger("itemSwipeRight",e,{rowIndex:l,$target:s});break;default:e.config.isScroll=!0}}}),e.$list.on("touchend",".um-listview-row",function(t){e.itemSwipeSupport&&(e.config.ensureTouchDirect=!1,e.config.isScroll=!0,$(this).removeData("touchPosOri"))}),e.resizeFn=function(){e.opts.height>0?e.$element.height(e.opts.height):e.$parent.addClass("um-listview-adaptation"),e.opts.width>0&&e.$element.width(e.opts.width)},e.resizeFn()},e.prototype.refresh=function(){this._continuousPullTimes=0,this.hideLoadingBar()},e.prototype.hideLoadingBar=function(){if(!this._$domResult)return!1;"down"==this._pullDirection?this.$element.scrollTop(0):"up"==this._pullDirection&&this.$element.scrollTop(this.$element[0].scrollHeight),this.config.insertDOM=!1,this._$domResult.remove(),this.isPulling=!1,this.config.itemSwipeEnable=!0},e.prototype.on=function(t,e){if("string"!=typeof t)return console.log("on方法的第一个参数必须为字符串"),!1;switch(t){case"pullDown":this.pullDown(e);break;case"pullUp":this.pullUp(e);break;case"tapHold":this.tapHold(e);break;case"itemSwipeLeft":this.itemSwipeLeft(e);break;case"itemSwipeRight":this.itemSwipeRight(e);break;case"itemClick":this.itemClick(e);break;case"itemDelete":this.itemDelete(e)}return this},e.prototype.pullDown=function(t){return"function"==typeof t&&(this.config.pullDownEnable=!0,this._events.on("pullDown",t)),this},e.prototype.pullUp=function(t){return"function"==typeof t&&(this.config.pullUpEnable=!0,this._events.on("pullUp",t)),this},e.prototype.tapHold=function(t){return"function"==typeof t&&(this.config.tapHoldEnable=!0,this._events.on("longTap",t)),this},e.prototype.itemClick=function(e){var i=this;return"function"==typeof e&&(this._events.on("itemClick",e),this.config.itemClickEnable||(this.$list.delegate(".um-listview-row","click",function(e){t.event.preventDefault();var o=$(this),n=o.find(".um-swipe-btns"),s=o.index(),l={rowIndex:s,$target:o};n.length&&n.find(e.target).length||i._events.trigger("itemClick",i,l)}),i.config.itemClickEnable=!0)),this},e.prototype.itemDelete=function(t){var e=this;return"function"==typeof t&&(this._events.on("itemDelete",function(e,i){i.$target.find(".um-swipe-btns").removeClass("um-swipe-open"),t(e,i)}),this.config.itemDeleteEnable||(this.$list.delegate(".um-listview-row .um-delete","click",function(t){t.stopPropagation(),t.preventDefault();var i=$(this).closest("li"),o=i.index(),n={rowIndex:o,$target:i};e._events.trigger("itemDelete",e,n)}),this.config.itemDeleteEnable=!0)),this},e.prototype.itemSwipeLeft=function(t){return"function"==typeof t&&(this.config.itemSwipeEnable=!0,this._events.on("itemSwipeLeft",t)),this},e.prototype.itemSwipeRight=function(t){return"function"==typeof t&&(this.config.itemSwipeEnable=!0,this._events.on("itemSwipeRight",t)),this},e.prototype.showItemMenu=function(t){if("object"!=typeof t)return!1;var e=t.find(".um-swipe-btns"),i=e.width();e.addClass("um-swipe-open"),t.children(".um-list-item").css("transform","translate3d("+-i+"px,0,0)")},e.prototype.hideItemMenu=function(t){if("object"!=typeof t)return!1;t.find(".um-swipe-btns").removeClass("um-swipe-open"),t.children(".um-list-item").css("transform","translate3d(0,0,0)")},t.UM.ListView=e,t.UM.listview=function(t,i){return new e(t,i)}});